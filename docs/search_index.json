[["index.html", "Introduction to Geographic Information Systems 1 Introduction", " Introduction to Geographic Information Systems 2022-02-09 1 Introduction library(tidyverse) library(tmap) library(sf) "],["loading-data.html", "2 Loading data", " 2 Loading data Let’s begin by reading in the Stanford Policing Project State Patrol data for the state of Colorado; the data can be downloaded from this website, but has also been made available to you as part of the workshop materials as a CSV file. Once, the traffic patrol data has been downloaded into your working directory, pass the name of the file to the read_csv function, and assign it to an object. Here, we’ll assign the traffic patrol data to an object named co_traffic_stops. Note that object names are arbitrary, but ideally should meaningfully describe their contents. # Read in Stanford police data for Colorado and assign to object named &quot;co_traffic_stops&quot; co_traffic_stops&lt;-read_csv(&quot;co_statewide_2020_04_01.csv&quot;) ## ## ── Column specification ───────────────────────────────────────────────────────────────────────────────────────── ## cols( ## .default = col_character(), ## date = col_date(format = &quot;&quot;), ## time = col_logical(), ## subject_age = col_double(), ## arrest_made = col_logical(), ## citation_issued = col_logical(), ## warning_issued = col_logical(), ## contraband_found = col_logical(), ## search_conducted = col_logical() ## ) ## ℹ Use `spec()` for the full column specifications. Once the traffic patrol data has been read into R studio and assigned to the object, we can print the contents of the dataset to the console by typing the name of the object into the R Studio console (note that only the first few records will be printed) # Print the contents of &quot;co_traffic_stops&quot; (i.e. the CO traffic patrol data) to the console; the first few records of the dataset will print co_traffic_stops ## # A tibble: 3,112,853 × 20 ## raw_row_number date time location county_name subject_age subject_race subject_sex officer_id_hash ## &lt;chr&gt; &lt;date&gt; &lt;lgl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; ## 1 1947986|1947987 2013-06-19 NA 19, I70… Mesa County 26 hispanic male b942632983 ## 2 1537576 2012-08-24 NA 254, H2… Jefferson … NA &lt;NA&gt; &lt;NA&gt; f3d4f46927 ## 3 1581594 2012-09-23 NA 115, I7… Logan Coun… 52 white male 6e49e2fbc8 ## 4 1009205 2011-08-25 NA 197, H8… Douglas Co… 32 white female eaea851669 ## 5 1932619 2013-06-08 NA 107, H2… Kiowa Coun… 33 hispanic male d18e34d749 ## 6 1179436 2011-12-23 NA 48, 384… Boulder Co… NA &lt;NA&gt; &lt;NA&gt; b84c696aed ## 7 1326795 2012-04-07 NA 0, R250… Boulder Co… 39 white male 4c0279748e ## 8 1786795 2013-03-03 NA 19, E47… Arapahoe C… 44 white female e6b5b9bb98 ## 9 1552164 2012-09-02 NA 224, H2… Park County NA &lt;NA&gt; &lt;NA&gt; 43f1f150d3 ## 10 1004281|1004282|10… 2011-08-21 NA R2000, … Adams Coun… 32 hispanic male dd2f10b6f8 ## # … with 3,112,843 more rows, and 11 more variables: officer_sex &lt;chr&gt;, type &lt;chr&gt;, violation &lt;chr&gt;, ## # arrest_made &lt;lgl&gt;, citation_issued &lt;lgl&gt;, warning_issued &lt;lgl&gt;, outcome &lt;chr&gt;, contraband_found &lt;lgl&gt;, ## # search_conducted &lt;lgl&gt;, search_basis &lt;chr&gt;, raw_Ethnicity &lt;chr&gt; We can also view co_traffic_stops object (or, for that matter, any dataset in R Studio) within the R Studio data viewer by passing the name of the object to the View function: # Inspect ```co_traffic_stops``` in the R Studio data viewer View(co_traffic_stops) "],["cleaning-and-filtering-data.html", "3 Cleaning and filtering data 3.1 Create a “Year” field 3.2 Filter by year", " 3 Cleaning and filtering data To make things tractable (after all, the entire dataset has more than 3,000,000 observations), let’s focus our attention on Colorado traffic patrol from the year 2010; this also has the advantage of allowing us to eventually use 2010 census data in crafting our measure of racial bias in traffic stops. Note that currently, there isn’t a separate field which contains the year in which a particular stop took place; rather, there is a “date” field, in which the date is stored in YYYY-MM-DD format. The easiest way to extract observations from the year 2010 is therefore to first extract the YYYY information from the “date” field, and use that information to make a new “Year” field, which only contains the year of a given stop. 3.1 Create a “Year” field To create this new “Year” field within co_traffic_stops, we can use the mutate function, which is a tidyverse function that allows us to define new variables within a dataset, and the substr function, which allows us to extract a subset of a given string. The code below takes the data in the co_traffic_stops object, and then (%&gt;%) creates a new field named “Year” using the mutate function; this field is set equal to the the first four digits of the existing “date” field by passing co_traffic_stops$data, 1, 4 to the substr function: # Creates &quot;Year&quot; field, that contains the year of a given stop, in &quot;co_traffic_stops&quot; co_traffic_stops&lt;-co_traffic_stops %&gt;% mutate(Year=substr(co_traffic_stops$date, 1,4)) We can check to make sure that the “Year” field has been successfully created by viewing co_traffic_stops in the R Studio data viewer with View(co_traffic_stops). 3.2 Filter by year Now that we have created the “Year” field, we can use it to filter the 2010 observations, and assign the 2010 stops to a new object named co_traffic_stops_2010: # Filter 2010 observations and assign to a new object co_traffic_stops_2010&lt;-co_traffic_stops %&gt;% filter(Year==2010) When we print the contents of the newly created co_traffic_stops_2010 object, note that the observations are now only from 2010. # Print contents of &quot;co_traffic_stops_2010&quot; object co_traffic_stops_2010 ## # A tibble: 470,284 × 21 ## date Year county_name subject_race raw_row_number time location subject_age subject_sex ## &lt;date&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;lgl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 2010-04-17 2010 Montezuma County white 188721|188722 NA 2, 989,… 16 female ## 2 2010-04-17 2010 Montezuma County white 187958 NA 991, 32 54 male ## 3 2010-04-17 2010 Montezuma County hispanic 188451 NA 9, 280,… 49 male ## 4 2010-04-17 2010 Montezuma County white 186989|186990|186991|18… NA 3, 277,… 16 male ## 5 2010-04-17 2010 Montezuma County white 186997|186998|186999|18… NA 3, 277,… 37 male ## 6 2010-04-17 2010 Montezuma County white 186993|186994|186995|18… NA 3, 277,… 39 male ## 7 2010-12-21 2010 Mineral County &lt;NA&gt; 600865 NA 164.5, … 110 &lt;NA&gt; ## 8 2010-12-21 2010 Mineral County &lt;NA&gt; 600477 NA 163, 29… 110 &lt;NA&gt; ## 9 2010-01-20 2010 Pueblo County hispanic 36625|36626 NA 312, H5… 45 male ## 10 2010-01-01 2010 Chaffee County white 275 NA 127, H2… 17 female ## # … with 470,274 more rows, and 12 more variables: officer_id_hash &lt;chr&gt;, officer_sex &lt;chr&gt;, type &lt;chr&gt;, ## # violation &lt;chr&gt;, arrest_made &lt;lgl&gt;, citation_issued &lt;lgl&gt;, warning_issued &lt;lgl&gt;, outcome &lt;chr&gt;, ## # contraband_found &lt;lgl&gt;, search_conducted &lt;lgl&gt;, search_basis &lt;chr&gt;, raw_Ethnicity &lt;chr&gt; "],["transforming-data.html", "4 Transforming Data 4.1 Tabulate county-level count of traffic stops by race 4.2 Reshape the data 4.3 Calculate total stops for each county in co_county_summary_wide 4.4 Clean co_county_summary_wide and assign to new object", " 4 Transforming Data Now that we have created a new data object that contains information on traffic stops from our year of interest (2010), let’s do a bit of work with the data so that we can find out the total number of traffic stops within each county, and the number of stops within each county in which the person stopped by the traffic police was Black. 4.1 Tabulate county-level count of traffic stops by race First, let’s find out the racial breakdown of stops for each county, using the data in the “subject_race” field of co_traffice_stops_2010. Below, we take co_traffic_stops_2010 object, declare “county_name” as a grouping variable using group_by(county_name), and then count up the number of stops associated with each racial category within each county using count(subject_race). The dataset thats results from these operations is assigned to a new object named co_county_summary: # Compute county-level count of traffic stops by race co_county_summary&lt;-co_traffic_stops_2010 %&gt;% group_by(county_name) %&gt;% count(subject_race) Let’s print the first few rows from the dataset and observe its structure: co_county_summary ## # A tibble: 439 × 3 ## # Groups: county_name [65] ## county_name subject_race n ## &lt;chr&gt; &lt;chr&gt; &lt;int&gt; ## 1 Adams County asian/pacific islander 582 ## 2 Adams County black 1208 ## 3 Adams County hispanic 8012 ## 4 Adams County other 36 ## 5 Adams County unknown 462 ## 6 Adams County white 20225 ## 7 Adams County &lt;NA&gt; 3825 ## 8 Alamosa County asian/pacific islander 18 ## 9 Alamosa County black 43 ## 10 Alamosa County hispanic 1537 ## # … with 429 more rows 4.2 Reshape the data co_county_summary_wide&lt;-co_county_summary %&gt;% pivot_wider(names_from=subject_race, values_from=n) 4.3 Calculate total stops for each county in co_county_summary_wide co_county_summary_wide&lt;-co_county_summary_wide %&gt;% rowwise() %&gt;% mutate(total_stops=sum(c_across(where(is.integer)), na.rm=TRUE)) co_county_summary_wide ## # A tibble: 65 × 9 ## # Rowwise: county_name ## county_name `asian/pacific islander` black hispanic other unknown white `NA` total_stops ## &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; ## 1 Adams County 582 1208 8012 36 462 20225 3825 34350 ## 2 Alamosa County 18 43 1537 9 30 2427 414 4478 ## 3 Arapahoe County 540 1819 1862 12 300 11089 1898 17520 ## 4 Archuleta County 17 28 392 71 41 4125 417 5091 ## 5 Baca County 11 61 288 NA 6 971 174 1511 ## 6 Bent County 8 46 314 1 6 1155 278 1808 ## 7 Boulder County 345 192 1050 10 180 9682 1594 13053 ## 8 Broomfield County 32 22 104 3 18 690 226 1095 ## 9 Chaffee County 43 37 361 9 71 4806 1194 6521 ## 10 Cheyenne County 10 38 147 3 2 821 85 1106 ## # … with 55 more rows 4.4 Clean co_county_summary_wide and assign to new object co_county_black_stops&lt;-co_county_summary_wide %&gt;% select(county_name, black, total_stops) co_county_black_stops&lt;-co_county_black_stops %&gt;% rename(black_stops=black) co_county_black_stops&lt;-co_county_black_stops %&gt;% filter(county_name!=&quot;NA&quot;) co_county_black_stops ## # A tibble: 64 × 3 ## # Rowwise: county_name ## county_name black_stops total_stops ## &lt;chr&gt; &lt;int&gt; &lt;int&gt; ## 1 Adams County 1208 34350 ## 2 Alamosa County 43 4478 ## 3 Arapahoe County 1819 17520 ## 4 Archuleta County 28 5091 ## 5 Baca County 61 1511 ## 6 Bent County 46 1808 ## 7 Boulder County 192 13053 ## 8 Broomfield County 22 1095 ## 9 Chaffee County 37 6521 ## 10 Cheyenne County 38 1106 ## # … with 54 more rows "],["defining-an-index-of-racial-bias-in-traffic-stops.html", "5 Defining an index of racial bias in traffic stops 5.1 Read in and join 2010 census data to co_county_black_stops 5.2 Join census data to co_county_black_stops 5.3 Define the variables that will be used in the bias index 5.4 Calculate the bias index 5.5 Compute summary statistics for the bias index 5.6 Visualize county-level variation in the bias index using ggplot", " 5 Defining an index of racial bias in traffic stops 5.1 Read in and join 2010 census data to co_county_black_stops Read in census data co_counties_census_2010&lt;-read_csv(&quot;co_county_decennial_census.csv&quot;) ## ## ── Column specification ───────────────────────────────────────────────────────────────────────────────────────── ## cols( ## GEOID = col_character(), ## County = col_character(), ## total_pop = col_double(), ## total_black_pop_over17 = col_double(), ## total_pop_over17 = col_double() ## ) # Prints contents of &quot;co_counties_census_2010&quot; co_counties_census_2010 ## # A tibble: 64 × 5 ## GEOID County total_pop total_black_pop_over17 total_pop_over17 ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 08023 Costilla County 3524 18 2788 ## 2 08025 Crowley County 5823 556 5034 ## 3 08027 Custer County 4255 37 3525 ## 4 08029 Delta County 30952 139 24101 ## 5 08031 Denver County 600158 45338 471392 ## 6 08035 Douglas County 285465 2447 198453 ## 7 08033 Dolores County 2064 4 1602 ## 8 08049 Grand County 14843 43 11825 ## 9 08039 Elbert County 23086 122 17232 ## 10 08041 El Paso County 622263 27280 459587 ## # … with 54 more rows 5.2 Join census data to co_county_black_stops co_counties_census_trafficstops&lt;-full_join(co_county_black_stops, co_counties_census_2010, by=c(&quot;county_name&quot;=&quot;County&quot;)) co_counties_census_trafficstops ## # A tibble: 64 × 7 ## # Rowwise: county_name ## county_name black_stops total_stops GEOID total_pop total_black_pop_over17 total_pop_over17 ## &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Adams County 1208 34350 08001 441603 9396 315480 ## 2 Alamosa County 43 4478 08003 15445 142 11617 ## 3 Arapahoe County 1819 17520 08005 572003 40558 424679 ## 4 Archuleta County 28 5091 08007 12084 19 9676 ## 5 Baca County 61 1511 08009 3788 15 2974 ## 6 Bent County 46 1808 08011 6499 486 5403 ## 7 Boulder County 192 13053 08013 294567 1961 231813 ## 8 Broomfield County 22 1095 08014 55889 415 41237 ## 9 Chaffee County 37 6521 08015 17809 264 14821 ## 10 Cheyenne County 38 1106 08017 1836 4 1386 ## # … with 54 more rows 5.3 Define the variables that will be used in the bias index co_counties_census_trafficstops&lt;-co_counties_census_trafficstops %&gt;% mutate(black_stop_pct=((black_stops/total_stops)*100), black_pop_pct=((total_black_pop_over17/total_pop_over17)*100)) co_counties_census_trafficstops ## # A tibble: 64 × 9 ## # Rowwise: county_name ## county_name black_stops total_stops GEOID total_pop total_black_pop_ove… total_pop_over17 black_stop_pct ## &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Adams County 1208 34350 08001 441603 9396 315480 3.52 ## 2 Alamosa County 43 4478 08003 15445 142 11617 0.960 ## 3 Arapahoe County 1819 17520 08005 572003 40558 424679 10.4 ## 4 Archuleta County 28 5091 08007 12084 19 9676 0.550 ## 5 Baca County 61 1511 08009 3788 15 2974 4.04 ## 6 Bent County 46 1808 08011 6499 486 5403 2.54 ## 7 Boulder County 192 13053 08013 294567 1961 231813 1.47 ## 8 Broomfield County 22 1095 08014 55889 415 41237 2.01 ## 9 Chaffee County 37 6521 08015 17809 264 14821 0.567 ## 10 Cheyenne County 38 1106 08017 1836 4 1386 3.44 ## # … with 54 more rows, and 1 more variable: black_pop_pct &lt;dbl&gt; 5.4 Calculate the bias index co_counties_census_trafficstops&lt;-co_counties_census_trafficstops %&gt;% mutate(excess_stops_index=black_stop_pct-black_pop_pct) co_counties_census_trafficstops ## # A tibble: 64 × 10 ## # Rowwise: county_name ## county_name black_stops total_stops GEOID total_pop total_black_pop_ove… total_pop_over17 black_stop_pct ## &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Adams County 1208 34350 08001 441603 9396 315480 3.52 ## 2 Alamosa County 43 4478 08003 15445 142 11617 0.960 ## 3 Arapahoe County 1819 17520 08005 572003 40558 424679 10.4 ## 4 Archuleta County 28 5091 08007 12084 19 9676 0.550 ## 5 Baca County 61 1511 08009 3788 15 2974 4.04 ## 6 Bent County 46 1808 08011 6499 486 5403 2.54 ## 7 Boulder County 192 13053 08013 294567 1961 231813 1.47 ## 8 Broomfield County 22 1095 08014 55889 415 41237 2.01 ## 9 Chaffee County 37 6521 08015 17809 264 14821 0.567 ## 10 Cheyenne County 38 1106 08017 1836 4 1386 3.44 ## # … with 54 more rows, and 2 more variables: black_pop_pct &lt;dbl&gt;, excess_stops_index &lt;dbl&gt; 5.5 Compute summary statistics for the bias index describe(co_counties_census_trafficstops$excess_stops_index) ## vars n mean sd median trimmed mad min max range skew kurtosis se ## X1 1 62 0.53 2.04 0.47 0.65 0.59 -9.84 4.26 14.1 -2.45 10.67 0.26 5.6 Visualize county-level variation in the bias index using ggplot co_counties_census_trafficstops&lt;-co_counties_census_trafficstops %&gt;% mutate(County=str_remove(county_name, &quot; County&quot;)) bias_graph&lt;-co_counties_census_trafficstops %&gt;% drop_na(excess_stops_index) %&gt;% ggplot()+ geom_col(aes(x=reorder(County, excess_stops_index), y=excess_stops_index))+ coord_flip()+ labs(title=&quot;Racial Discrimination in Police Stops, by County (Colorado)&quot;, x=&quot;County&quot;, y=&quot;Bias Index=\\nBlack Percentage of Overall Traffic Stops – Black Percentage of Overall Over-17 Population&quot;)+ theme(axis.title.x = element_text(size = 9))+ scale_y_continuous(breaks=c(-10, -7.5, -5, -2.5, 0, 2.5, 5, 7.5))+ expand_limits(y=c(-10,10))+ theme(plot.title=element_text(hjust=0.5)) bias_graph "],["mapping-the-bias-index.html", "6 Mapping the bias index 6.1 Read in and view the shapefile of CO counties 6.2 Join co_counties_census_trafficstops to the shapefile of Colorado counties 6.3 Display the bias index on a map of Colorado counties", " 6 Mapping the bias index 6.1 Read in and view the shapefile of CO counties # Reads in shapefile and assigns to object named &quot;co_counties_shapefile&quot; co_counties_shapefile&lt;-st_read(&quot;tl_2019_08_county.shp&quot;) ## Reading layer `tl_2019_08_county&#39; from data source `/Users/adra7980/Documents/CU_workshops/gis/data/tl_2019_08_county/tl_2019_08_county.shp&#39; using driver `ESRI Shapefile&#39; ## Simple feature collection with 64 features and 17 fields ## geometry type: MULTIPOLYGON ## dimension: XY ## bbox: xmin: -109.0602 ymin: 36.99245 xmax: -102.0415 ymax: 41.00344 ## geographic CRS: NAD83 co_counties_shapefile ## Simple feature collection with 64 features and 17 fields ## geometry type: MULTIPOLYGON ## dimension: XY ## bbox: xmin: -109.0602 ymin: 36.99245 xmax: -102.0415 ymax: 41.00344 ## geographic CRS: NAD83 ## First 10 features: ## STATEFP COUNTYFP COUNTYNS GEOID NAME NAMELSAD LSAD CLASSFP MTFCC CSAFP CBSAFP METDIVFP FUNCSTAT ## 1 08 109 00198170 08109 Saguache Saguache County 06 H1 G4020 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; A ## 2 08 115 00198173 08115 Sedgwick Sedgwick County 06 H1 G4020 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; A ## 3 08 017 00198124 08017 Cheyenne Cheyenne County 06 H1 G4020 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; A ## 4 08 027 00198129 08027 Custer Custer County 06 H1 G4020 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; A ## 5 08 067 00198148 08067 La Plata La Plata County 06 H1 G4020 &lt;NA&gt; 20420 &lt;NA&gt; A ## 6 08 111 00198171 08111 San Juan San Juan County 06 H1 G4020 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; A ## 7 08 097 00198164 08097 Pitkin Pitkin County 06 H1 G4020 233 24060 &lt;NA&gt; A ## 8 08 093 00198162 08093 Park Park County 06 H1 G4020 216 19740 &lt;NA&gt; A ## 9 08 003 00198117 08003 Alamosa Alamosa County 06 H1 G4020 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; A ## 10 08 099 00198165 08099 Prowers Prowers County 06 H1 G4020 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; A ## ALAND AWATER INTPTLAT INTPTLON geometry ## 1 8206547705 4454510 +38.0316514 -106.2346662 MULTIPOLYGON (((-106.8714 3... ## 2 1419419016 3530746 +40.8715679 -102.3553579 MULTIPOLYGON (((-102.6521 4... ## 3 4605713960 8166129 +38.8356456 -102.6017914 MULTIPOLYGON (((-102.5769 3... ## 4 1913031921 3364150 +38.1019955 -105.3735123 MULTIPOLYGON (((-105.7969 3... ## 5 4376255148 25642578 +37.2873673 -107.8397178 MULTIPOLYGON (((-108.2952 3... ## 6 1003660672 2035929 +37.7810492 -107.6702567 MULTIPOLYGON (((-107.9751 3... ## 7 2514104907 6472577 +39.2175376 -106.9161587 MULTIPOLYGON (((-106.9154 3... ## 8 5682182508 43519840 +39.1189141 -105.7176479 MULTIPOLYGON (((-105.9751 3... ## 9 1871465874 1847610 +37.5684423 -105.7880414 MULTIPOLYGON (((-106.0393 3... ## 10 4243429484 15345176 +37.9581814 -102.3921613 MULTIPOLYGON (((-102.2111 3... ## tmap mode set to plotting tm_shape(co_counties_shapefile)+ tm_polygons() co_counties_map&lt;-tm_shape(co_counties_shapefile)+ tm_polygons() co_counties_map tmap_mode(&quot;view&quot;) ## tmap mode set to interactive viewing co_counties_map tmap_mode(&quot;plot&quot;) ## tmap mode set to plotting co_counties_map 6.2 Join co_counties_census_trafficstops to the shapefile of Colorado counties county_shapefile_biasIndex&lt;-full_join(co_counties_shapefile, co_counties_census_trafficstops, by=&quot;GEOID&quot;) county_shapefile_biasIndex ## Simple feature collection with 64 features and 27 fields ## geometry type: MULTIPOLYGON ## dimension: XY ## bbox: xmin: -109.0602 ymin: 36.99245 xmax: -102.0415 ymax: 41.00344 ## geographic CRS: NAD83 ## First 10 features: ## STATEFP COUNTYFP COUNTYNS GEOID NAME NAMELSAD LSAD CLASSFP MTFCC CSAFP CBSAFP METDIVFP FUNCSTAT ## 1 08 109 00198170 08109 Saguache Saguache County 06 H1 G4020 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; A ## 2 08 115 00198173 08115 Sedgwick Sedgwick County 06 H1 G4020 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; A ## 3 08 017 00198124 08017 Cheyenne Cheyenne County 06 H1 G4020 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; A ## 4 08 027 00198129 08027 Custer Custer County 06 H1 G4020 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; A ## 5 08 067 00198148 08067 La Plata La Plata County 06 H1 G4020 &lt;NA&gt; 20420 &lt;NA&gt; A ## 6 08 111 00198171 08111 San Juan San Juan County 06 H1 G4020 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; A ## 7 08 097 00198164 08097 Pitkin Pitkin County 06 H1 G4020 233 24060 &lt;NA&gt; A ## 8 08 093 00198162 08093 Park Park County 06 H1 G4020 216 19740 &lt;NA&gt; A ## 9 08 003 00198117 08003 Alamosa Alamosa County 06 H1 G4020 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; A ## 10 08 099 00198165 08099 Prowers Prowers County 06 H1 G4020 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; A ## ALAND AWATER INTPTLAT INTPTLON county_name black_stops total_stops total_pop ## 1 8206547705 4454510 +38.0316514 -106.2346662 Saguache County 20 2741 6108 ## 2 1419419016 3530746 +40.8715679 -102.3553579 Sedgwick County 26 762 2379 ## 3 4605713960 8166129 +38.8356456 -102.6017914 Cheyenne County 38 1106 1836 ## 4 1913031921 3364150 +38.1019955 -105.3735123 Custer County 1 118 4255 ## 5 4376255148 25642578 +37.2873673 -107.8397178 La Plata County 70 11305 51334 ## 6 1003660672 2035929 +37.7810492 -107.6702567 San Juan County 1 125 699 ## 7 2514104907 6472577 +39.2175376 -106.9161587 Pitkin County 4 487 17148 ## 8 5682182508 43519840 +39.1189141 -105.7176479 Park County 64 8057 16206 ## 9 1871465874 1847610 +37.5684423 -105.7880414 Alamosa County 43 4478 15445 ## 10 4243429484 15345176 +37.9581814 -102.3921613 Prowers County 247 6594 12551 ## total_black_pop_over17 total_pop_over17 black_stop_pct black_pop_pct excess_stops_index County ## 1 8 4692 0.7296607 0.1705030 0.5591577 Saguache ## 2 7 1919 3.4120735 0.3647733 3.0473002 Sedgwick ## 3 4 1386 3.4358047 0.2886003 3.1472044 Cheyenne ## 4 37 3525 0.8474576 1.0496454 -0.2021878 Custer ## 5 160 40822 0.6191950 0.3919455 0.2272495 La Plata ## 6 0 571 0.8000000 0.0000000 0.8000000 San Juan ## 7 69 14149 0.8213552 0.4876670 0.3336883 Pitkin ## 8 52 13098 0.7943403 0.3970072 0.3973331 Park ## 9 142 11617 0.9602501 1.2223466 -0.2620964 Alamosa ## 10 47 9147 3.7458295 0.5138297 3.2319999 Prowers ## geometry ## 1 MULTIPOLYGON (((-106.8714 3... ## 2 MULTIPOLYGON (((-102.6521 4... ## 3 MULTIPOLYGON (((-102.5769 3... ## 4 MULTIPOLYGON (((-105.7969 3... ## 5 MULTIPOLYGON (((-108.2952 3... ## 6 MULTIPOLYGON (((-107.9751 3... ## 7 MULTIPOLYGON (((-106.9154 3... ## 8 MULTIPOLYGON (((-105.9751 3... ## 9 MULTIPOLYGON (((-106.0393 3... ## 10 MULTIPOLYGON (((-102.2111 3... 6.3 Display the bias index on a map of Colorado counties 6.3.1 Make a rough draft of a map traffic_stop_bias_map&lt;-tm_shape(county_shapefile_biasIndex)+ tm_polygons(col=&quot;excess_stops_index&quot;, palette=&quot;YlOrRd&quot;, textNA=&quot;No Data&quot;, n=5, style=&quot;jenks&quot;, midpoint=F)+ tm_layout(frame=FALSE, legend.outside=TRUE) traffic_stop_bias_map 6.3.2 Make a map with custom breaks traffic_stop_bias_map&lt;-tm_shape(county_shapefile_biasIndex)+ tm_polygons(col=&quot;excess_stops_index&quot;, palette=&quot;YlOrRd&quot;, textNA=&quot;No Data&quot;, n=5, breaks=c(-10,-5, 0, 2, 4, 5), midpoint=F)+ tm_layout(frame=FALSE, legend.outside=TRUE) traffic_stop_bias_map 6.3.3 Make a map with custom colors my_colors&lt;-c(&quot;white&quot;, &quot;peachpuff&quot;, &quot;red1&quot;, &quot;red4&quot;, &quot;navy&quot;) traffic_stop_bias_map&lt;-tm_shape(county_shapefile_biasIndex)+ tm_polygons(col=&quot;excess_stops_index&quot;, palette=my_colors, textNA=&quot;No Data&quot;, n=5, breaks=c(-10,-5, 0, 2, 4, 5))+ tm_layout(frame=FALSE, legend.outside=TRUE) traffic_stop_bias_map 6.3.4 Make a categorical map Define categorical column county_shapefile_biasIndex&lt;- county_shapefile_biasIndex %&gt;% mutate(apparent_bias=ifelse(excess_stops_index&gt;0, &quot;Apparent Bias&quot;, &quot;No Apparent Bias&quot;)) categorical_map&lt;-tm_shape(county_shapefile_biasIndex)+ tm_polygons(col=&quot;apparent_bias&quot;, title=&quot;&quot;, pal=c(&quot;orangered1&quot;, &quot;white&quot;), textNA=&quot;No Data&quot;)+ tm_layout(frame=FALSE, legend.outside=TRUE) categorical_map "],["refining-and-formatting-the-maps-of-the-colorado-traffic-stop-bias-index.html", "7 Refining and formatting the maps of the Colorado traffic-stop bias index 7.1 Refining the map of the continuous bias variable 7.2 Refining the map of the categorical bias variable", " 7 Refining and formatting the maps of the Colorado traffic-stop bias index 7.1 Refining the map of the continuous bias variable my_colors&lt;-c(&quot;white&quot;, &quot;peachpuff&quot;, &quot;red1&quot;, &quot;red4&quot;, &quot;navy&quot;) traffic_stop_bias_map&lt;-tm_shape(county_shapefile_biasIndex)+ tm_polygons(col=&quot;excess_stops_index&quot;, palette=my_colors, title=&quot;(Black % of Traffic Stops) - (Black % of Population)&quot;, textNA=&quot;No Data&quot;, n=5, breaks=c(-10,-5, 0.01, 2, 4, 5))+ tm_layout(frame=FALSE, legend.outside=TRUE, legend.text.size=0.68, legend.title.size=0.75, title=&quot;Traffic Stop Racial Bias Index&quot;, title.size=0.75, title.fontface = 2, main.title=&quot;Racial Bias in Traffic Stops, by County (Colorado)&quot;, main.title.position=0.03, main.title.size=1, attr.outside=TRUE)+ tm_credits(&quot;Map Author: NAME\\nData Sources: 2010 Decennial Census via tidyverse,\\nStanford Open Policing Project,\\nColorado GeoLibrary &quot;, # Sets text for map credits position=c(0.02,0.01), # Specifies location of map credits size=0.38) traffic_stop_bias_map traffic_stop_bias_labeled&lt;-traffic_stop_bias_map+ tm_text(&quot;NAME&quot;, size=0.30, fontface=2) traffic_stop_bias_labeled tmap_mode(&quot;view&quot;) ## tmap mode set to interactive viewing traffic_stop_bias_labeled ## Credits not supported in view mode. tmap_mode(&quot;plot&quot;) ## tmap mode set to plotting 7.2 Refining the map of the categorical bias variable categorical_map&lt;-tm_shape(county_shapefile_biasIndex)+ tm_polygons(col=&quot;apparent_bias&quot;, title=&quot;&quot;, pal=c(&quot;orangered1&quot;, &quot;white&quot;), textNA=&quot;No Data&quot;)+ tm_layout(frame=FALSE, legend.outside=TRUE, main.title=&quot;Racial Bias in Traffic Stops, by County (Colorado)&quot;, main.title.position=0.03, main.title.size=1, attr.outside=TRUE)+ tm_credits(&quot;Map Author: NAME\\nData Sources: 2010 Decennial Census via tidyverse,\\nStanford Open Policing Project,\\nColorado GeoLibrary &quot;, # Sets text for map credits position=c(0.02,0.01), # Specifies location of map credits size=0.38)+ tm_text(&quot;NAME&quot;, size=0.30, fontface=2) categorical_map "],["exporting-maps.html", "8 Exporting maps", " 8 Exporting maps tmap_save(traffic_stop_bias_labeled, &quot;traffic_stop_bias_labeled.png&quot;) ## Map saved to traffic_stop_bias_labeled.png ## Resolution: 2448.943 by 1800.777 pixels ## Size: 8.163142 by 6.002591 inches (300 dpi) "],["summary-script.html", "9 Summary script", " 9 Summary script # Read in Stanford police data for Colorado and assign to object named &quot;co_traffic_stops&quot; co_traffic_stops&lt;-read_csv(&quot;co_statewide_2020_04_01.csv&quot;) # Create &quot;Year&quot; field based on existing &quot;date&quot; field co_traffic_stops&lt;-co_traffic_stops %&gt;% mutate(Year=substr(co_traffic_stops$date, 1,4))# Filter 2010 observations and assign to a # # Filter 2010 observations and assign to a new object named &quot;co_traffic_stops_2010&quot; co_traffic_stops_2010&lt;-co_traffic_stops %&gt;% filter(Year==2010) # Compute county-level count of traffic stops by race and assign to object named &quot;co_county_summary&quot; co_county_summary&lt;-co_traffic_stops_2010 %&gt;% group_by(county_name) %&gt;% count(subject_race) # Reshape the data so that the racial categories are transposed # from rows into columns and assign the result to an object named # &quot;co_county_summary_wide&quot; co_county_summary_wide&lt;-co_county_summary %&gt;% pivot_wider(names_from=subject_race, values_from=n) # Creates a new column named &quot;total_stops&quot; in &quot;co_county_summary_wide&quot; that # contains information on the total number of stops for each county (across all racial categories) co_county_summary_wide&lt;-co_county_summary_wide %&gt;% rowwise() %&gt;% mutate(total_stops=sum(c_across(where(is.integer)), na.rm=TRUE)) # Selects &quot;county_name&quot;, &quot;black&quot;, and &quot;total_stops&quot; variables from &quot;co_county_summary_wide&quot;; # then renames the &quot;black&quot; variable to &quot;black_stops&quot; for clarity; then removes counties that # are named &quot;NA&quot; due to an error in the dataset co_county_black_stops&lt;-co_county_summary_wide %&gt;% select(county_name, black, total_stops) %&gt;% rename(black_stops=black) %&gt;% filter(county_name!=&quot;NA&quot;) # Read in the pre-prepared demographic data from the 2010 decennial census and assign # to an object named &quot;co_counties_census_2010&quot; co_counties_census_2010&lt;-read_csv(&quot;co_county_decennial_census.csv&quot;) # Join &quot;co_counties_census_2010&quot; to &quot;co_county_black_stops&quot; and assign the result # to an object named &quot;co_counties_census_trafficstops&quot; co_counties_census_trafficstops&lt;-full_join(co_county_black_stops, co_counties_census_2010, by=c(&quot;county_name&quot;=&quot;County&quot;)) # Use the information in &quot;co_counties_census_trafficstops&quot; to define new variables that will be used # to compute the racial bias index: &quot;black_stop_pct&quot; (the black percentage of overall traffic stops within # a county) and &quot;black_pop_pct&quot; (the black percentage of the county&#39;s over-17 population) co_counties_census_trafficstops&lt;- co_counties_census_trafficstops %&gt;% mutate(black_stop_pct=((black_stops/total_stops)*100), black_pop_pct=((total_black_pop_over17/total_pop_over17)*100)) # Calculate the bias index and include it as a new variable in &quot;co_counties_census_trafficstops&quot; co_counties_census_trafficstops&lt;-co_counties_census_trafficstops %&gt;% mutate(excess_stops_index=black_stop_pct-black_pop_pct) # Reads in Colorado county shapefile and assigns the shapefile to a new object named # &quot;co_counties_shapefile&quot; co_counties_shapefile&lt;-st_read(&quot;tl_2019_08_county.shp&quot;) # Join &quot;co_counties_census_trafficstops&quot; to &quot;co_counties_shapefile&quot; using &quot;GEOID&quot; as the join field; # assign the result to a new object named &quot;county_shapefile_biasIndex&quot; county_shapefile_biasIndex&lt;-full_join(co_counties_shapefile, co_counties_census_trafficstops, by=&quot;GEOID&quot;) # make a map of the continuous &quot;excess_stops_index&quot; my_colors&lt;-c(&quot;white&quot;, &quot;peachpuff&quot;, &quot;red1&quot;, &quot;red4&quot;, &quot;navy&quot;) # create color vector traffic_stop_bias_map&lt;- # object assignment; assigns map to object named &quot;traffic_stop_bias_map&quot; tm_shape(county_shapefile_biasIndex)+ # declares the spatial object that is the basis for the map tm_polygons(col=&quot;excess_stops_index&quot;, # declares variable containing data to be mapped palette=my_colors, # sets color scheme (based on &quot;my_colors&quot; vector) title=&quot;(Black % of Traffic Stops) - (Black % of Population)&quot;, # sets legend subtitle textNA=&quot;No Data&quot;, # Sets the name of the legend label for &quot;NA&quot; values n=5, # defines the number of intervals in the legend breaks=c(-10,-5, 0.01, 2, 4, 5))+ # sets custom legend breaks tm_layout(frame=FALSE, # removes bounding box legend.outside=TRUE, # sets legend outside (invisible) bounding box legend.text.size=0.68, # sets size of legend text elements legend.title.size=0.75, # sets size of legend main title title=&quot;Traffic Stop Racial Bias Index&quot;, # sets legend&#39;s main title title.size=0.75, # sets relative size of legend&#39;s subtitle title.fontface = 2, # Makes legend title bold main.title=&quot;Racial Bias in Traffic Stops, by County (Colorado)&quot;, # specifies main title of map main.title.position=0.03, # specifies position of main title main.title.size=1, # specifies size of main title attr.outside=TRUE)+ # specifies that map credits should be placed outside bounding box tm_credits(&quot;Map Author: NAME\\nData Sources: 2010 Decennial Census via tidyverse,\\nStanford Open Policing Project,\\nColorado GeoLibrary &quot;, # Sets text for map credits position=c(0.02,0.01), # Specifies location of map credits size=0.38) # sets title of credits # Prints map traffic_stop_bias_map lower bound on legend is inclusive, upper bound exclusive https://geo.colorado.edu/catalog/47540-5e712aeda3d91e0009f59fc7 "],["using-tidycensus-to-extract-relevant-census-data.html", "A Using tidycensus to extract relevant census data A.1 Step 1: Define your variables A.2 Step 2: Extract the variables using tidycensus A.3 Step 3: Clean the tidycensus dataset A.4 Step 4: Define new variables A.5 Step 5: Finalize and export the dataset", " A Using tidycensus to extract relevant census data This section provides a script used to extract the census dataset that was read into R Studio in Section 5.1. To save time during a workshop, it is recommended to prepare the census dataset required to create the relevant index beforehand, and simply provide students with the relevant dataset. However, if you are looking for a way to extract the census dataset within R, the following script can be used as a guide. Load packages library(tidycensus) library(tidyverse) Enter your census API key with the following code: census_api_key(&quot;INSERT HERE&quot;) A.1 Step 1: Define your variables # Variable list for 2010 Decennial decennial_2010_variables&lt;-load_variables(2010, &quot;sf1&quot;) # Define and name variables for census API call my_vars&lt;-c(total_pop=&quot;P001001&quot;, totalpop_men_u5=&quot;P012003&quot;, totalpop_men_5to9=&quot;P012004&quot;, totalpop_men_10to14=&quot;P012005&quot;, totalpop_men_15to17=&quot;P012006&quot;, totalpop_women_u5=&quot;P012027&quot;, totalpop_women_5to9=&quot;P012028&quot;, totalpop_women_10to14=&quot;P012029&quot;, totalpop_women_15to17=&quot;P012030&quot;, black_totalpop=&quot;PCT012B001&quot;, black_men_u1=&quot;PCT012B003&quot;, black_men_1=&quot;PCT012B004&quot;, black_men_2=&quot;PCT012B005&quot;, black_men_3=&quot;PCT012B006&quot;, black_men_4=&quot;PCT012B007&quot;, black_men_5=&quot;PCT012B008&quot;, black_men_6=&quot;PCT012B009&quot;, black_men_7=&quot;PCT012B010&quot;, black_men_8=&quot;PCT012B011&quot;, black_men_9=&quot;PCT012B012&quot;, black_men_10=&quot;PCT012B013&quot;, black_men_11=&quot;PCT012B014&quot;, black_men_12=&quot;PCT012B015&quot;, black_men_13=&quot;PCT012B016&quot;, black_men_14=&quot;PCT012B017&quot;, black_men_15=&quot;PCT012B018&quot;, black_men_16=&quot;PCT012B019&quot;, black_men_17=&quot;PCT012B020&quot;, black_women_u1=&quot;PCT012B107&quot;, black_women_1=&quot;PCT012B108&quot;, black_women_2=&quot;PCT012B109&quot;, black_women_3=&quot;PCT012B110&quot;, black_women_4=&quot;PCT012B111&quot;, black_women_5=&quot;PCT012B112&quot;, black_women_6=&quot;PCT012B113&quot;, black_women_7=&quot;PCT012B114&quot;, black_women_8=&quot;PCT012B115&quot;, black_women_9=&quot;PCT012B116&quot;, black_women_10=&quot;PCT012B117&quot;, black_women_11=&quot;PCT012B118&quot;, black_women_12=&quot;PCT012B119&quot;, black_women_13=&quot;PCT012B120&quot;, black_women_14=&quot;PCT012B121&quot;, black_women_15=&quot;PCT012B122&quot;, black_women_16=&quot;PCT012B123&quot;, black_women_17=&quot;PCT012B124&quot;) A.2 Step 2: Extract the variables using tidycensus # Issue call to Census API co_counties_race&lt;-get_decennial( geography=&quot;county&quot;, variables=my_vars, state=&quot;CO&quot;, survey=&quot;sf1&quot;, output=&quot;wide&quot;, year=2010, geometry=FALSE) ## Getting data from the 2010 decennial Census ## Using FIPS code &#39;08&#39; for state &#39;CO&#39; ## Using Census Summary File 1 A.3 Step 3: Clean the tidycensus dataset # Remove state name from name field co_counties_race&lt;-co_counties_race %&gt;% separate(col=NAME, c(&quot;County&quot;, &quot;x&quot;), sep=&quot;,&quot;) %&gt;% select(-x) A.4 Step 4: Define new variables # Create variable for total over-17 population co_counties_race&lt;-co_counties_race %&gt;% mutate(total_pop_over17=total_pop-totalpop_men_u5-totalpop_men_5to9- totalpop_men_10to14-totalpop_men_15to17-totalpop_women_u5- totalpop_women_5to9-totalpop_women_10to14-totalpop_women_15to17) # Create variable for total over--17 black population co_counties_race&lt;-co_counties_race %&gt;% mutate(total_black_pop_over17=black_totalpop-black_men_u1-black_men_1- black_men_2-black_men_3-black_men_4-black_men_5-black_men_6- black_men_7-black_men_8-black_men_9-black_men_10-black_men_11- black_men_12-black_men_13-black_men_14-black_men_15-black_men_16- black_men_17-black_women_u1-black_women_1-black_women_2-black_women_3- black_women_4-black_women_5-black_women_6-black_women_7-black_women_8- black_women_9-black_women_10-black_women_11-black_women_12- black_women_13-black_women_14-black_women_15-black_women_16- black_women_17) A.5 Step 5: Finalize and export the dataset #Select relevant variables co_counties_census_2010&lt;-co_counties_race %&gt;% select(GEOID, County, total_pop, total_black_pop_over17, total_pop_over17) co_counties_census_2010 ## # A tibble: 64 × 5 ## GEOID County total_pop total_black_pop_over17 total_pop_over17 ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 08023 Costilla County 3524 18 2788 ## 2 08025 Crowley County 5823 556 5034 ## 3 08027 Custer County 4255 37 3525 ## 4 08029 Delta County 30952 139 24101 ## 5 08031 Denver County 600158 45338 471392 ## 6 08035 Douglas County 285465 2447 198453 ## 7 08033 Dolores County 2064 4 1602 ## 8 08049 Grand County 14843 43 11825 ## 9 08039 Elbert County 23086 122 17232 ## 10 08041 El Paso County 622263 27280 459587 ## # … with 54 more rows # Export the data write_csv(co_counties_census_2010, &quot;co_counties_census_2010.csv&quot;) "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
